//package com.zhd.exploit.api.scheduled;
//
//import java.util.Date;
//import java.util.List;
//
//import org.springframework.beans.factory.annotation.Autowired;
//import org.springframework.scheduling.annotation.Scheduled;
//import org.springframework.stereotype.Component;
//
//import com.zhd.exploit.api.dto.AlipayDTO;
//import com.zhd.exploit.api.entity.PayLog;
//import com.zhd.exploit.api.entity.Payqrcode;
//import com.zhd.exploit.api.enums.PayState;
//import com.zhd.exploit.api.mapper.PayLogMapper;
//import com.zhd.exploit.api.mapper.PayqrcodeMapper;
//import com.zhd.exploit.api.service.PayResultService;
//
//import lombok.extern.slf4j.Slf4j;
//
///**
// * 
// * @author zhanghaodong
// * @version v1.0
// * @date 2018年10月23日 下午3:01:33
// * @work
// */
//@Slf4j
//@Component
//public class PayTask {
//
//	@Autowired
//	private PayqrcodeMapper payqrcodeMapper;
//	@Autowired
//	private PayLogMapper payLogMapper;
//	@Autowired
//	private PayResultService payResultService;
//
//	/**
//	 * 每30秒执行一次
//	 */
//	@Scheduled(fixedDelay = 30000)
//	public void scheduled1() {
//		try {
//			log.info("查询支付结果任务");
//			List<PayLog> payLogs = payLogMapper.queryWaitResult();
//			for (PayLog payLog : payLogs) {
//				AlipayDTO alipayDTO = payResultService.queryResult(payLog);
//				if (alipayDTO != null) {
//					payResultService.updatePaylog(payLog, alipayDTO);
//					// TODO 通知下家
//					payResultService.notice(payLog);
//				}
//			}
//		} catch (Exception e) {
//			e.printStackTrace();
//		}
//
//	}
//
//	/**
//	 * 每30秒执行一次,对于status=0&修改时间>10分钟的,执行status=1
//	 */
//	@Scheduled(fixedRate = 30000)
//	public void scheduled2() {
//		try {
//			List<Payqrcode> payqrcodes = payqrcodeMapper.queryStatusNotAva();
//			log.info("轮询scheduled2查询到[{}]条数据", payqrcodes.size());
//			for (Payqrcode payqrcode : payqrcodes) {
//				Payqrcode record = new Payqrcode();
//				record.setCodeid(payqrcode.getCodeid());
//				record.setStatus("1");// 设置为可用
//				record.setUpdatetime(new Date());
//				payqrcodeMapper.updateByPrimaryKeySelective(record);
//			}
//		} catch (Exception e) {
//			e.printStackTrace();
//		}
//	}
//
//}
